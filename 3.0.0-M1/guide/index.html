<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut Discovery Client</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#serviceDiscoveryConsul"><strong>3</strong><span>Consul Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#serviceDiscoveryEureka"><strong>4</strong><span>Eureka Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>5</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-serviceDiscoveryConsul"><a href="#serviceDiscoveryConsul"><strong>3</strong><span>Consul Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-serviceDiscoveryEureka"><a href="#serviceDiscoveryEureka"><strong>4</strong><span>Eureka Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>5</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut Discovery Client</h1>
        <p></p>
        <p>Adds Service Discovery Features for Eureka and Consul</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option value='https://micronaut-projects.github.io/micronaut-discovery-client/snapshot/guide/index.html'>SNAPSHOT</option><option selected='selected' value='https://micronaut-projects.github.io/micronaut-discovery-client/3.0.0-M1/guide/index.html'>3.0.0-M1</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.5.0/guide/index.html'>2.5.0</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.4.0/guide/index.html'>2.4.0</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.3.0/guide/index.html'>2.3.0</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.2.4/guide/index.html'>2.2.4</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.2.3/guide/index.html'>2.2.3</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.2.2/guide/index.html'>2.2.2</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.2.1/guide/index.html'>2.2.1</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.2.0/guide/index.html'>2.2.0</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.1.0/guide/index.html'>2.1.0</option><option value='https://micronaut-projects.github.io/micronaut-discovery-client/2.0.1/guide/index.html'>2.0.1</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-discovery-client/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply either of <code>discovery-consul</code> or <code>discovery-eureka</code> features to enable service-discovery in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features discovery-consul</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Service Discovery enables the ability for Microservices to find each other without necessarily knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>There are many ways Service Discovery can be implemented, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually implement Service Discovery using DNS without requiring a third party tool or component.</p>
</li>
<li>
<p>Use a discovery server such as <a href="https://github.com/Netflix/eureka">Eureka</a>, <a href="https://www.consul.io">Consul</a> or <a href="https://zookeeper.apache.org">ZooKeeper</a>.</p>
</li>
<li>
<p>Delegate the work to a container runtime, such as <a href="https://kubernetes.io">Kubernetes</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With that in mind, Micronaut tries to flexible to support all of these approaches. As of this writing, Micronaut features integrated support for the popular Service Discovery servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eureka</p>
</li>
<li>
<p>Consul</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To include Service Discovery in your application simply the first step is to add the <code>discovery-client</code> dependency to your application:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-discovery-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-discovery-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>The <code>discovery-client</code> dependency provides implementations of the <a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/DiscoveryClient">DiscoveryClient</a> interface.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/DiscoveryClient">DiscoveryClient</a> is fairly simple and provides two main entry points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/DiscoveryClient.html#getServiceIds--">DiscoveryClient.getServiceIds()</a> - Returns all discovered service IDs</p>
</li>
<li>
<p><a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/DiscoveryClient.html#getInstances-java.lang.String-">DiscoveryClient.getInstances(java.lang.String)</a> - Returns all the <a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/ServiceInstance">ServiceInstance</a> objects for a given service ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods return <a href="https://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances since the operation to retrieve service ID information may result in a blocking network call depending on the underlying implementation.</p>
</div>
<div class="paragraph">
<p>If you are using Micronaut&#8217;s cache module, the default implementation of the <code>DiscoveryClient</code> interface is <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/discovery/CachingCompositeDiscoveryClient">CachingCompositeDiscoveryClient</a> which merges all other <code>DiscoveryClient</code> beans into a single bean and provides caching of the results of the methods. The default behaviour is to cache for 30 seconds. This cache can be disabled in application configuration:</p>
</div>
<div class="listingblock">
<div class="title">Disabling the Discovery Client Cache</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  caches:
    discovery-client:
      enabled: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can alter the cache&#8217;s expiration policy:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Discovery Client Cache</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  caches:
    discovery-client:
      expire-after-access: 60s</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/discovery/DiscoveryClientCacheConfiguration">DiscoveryClientCacheConfiguration</a> class for available configuration options.</p>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-discovery-client/edit/master/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-discovery-client/releases">https://github.com/micronaut-projects/micronaut-discovery-client/releases</a></p>
</div>

<h1 id="serviceDiscoveryConsul"><a class="anchor" href="#serviceDiscoveryConsul"></a>3 Consul Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-discovery-client/edit/master/src/main/docs/guide/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="https://docs.micronaut.io/latest/guide/index.html#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_consul">Auto Registering with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a Micronaut application with Consul simply add the necessary <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Consul (application.yml)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
consul:
  client:
    registration:
      enabled: true
    defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the Micronaut CLI you can quickly create a new service setup with Consul using: <code>mn create-app my-app --features discovery-consul</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>consul.client.defaultZone</code> settings accepts a list of Consul servers to be used by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could also simply set <code>consul.client.host</code> and <code>consul.client.port</code>, however <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> allows you specify per zone discovery services for the purpose load balancing. A zone maps onto a AWS availability zone or a Google Cloud zone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default registering with Consul is disabled hence you should set <code>consul.client.registration.enabled</code> to <code>true</code>. Note that you may wish to do this only in your production configuration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Running multiple instances of a service may require an additional configuration param.  See below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are running the same applications on the same port across different servers it is important to set the <code>micronaut.application.instance.id</code> property or you will experience instance registration collision.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
    instance:
      id: ${random.shortuuid}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_consul_service_registration">Customizing Consul Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> class features a range of customization options for altering how an instance registers with Consul. You can customize the tags, the retry attempts, the fail fast behaviour and so on.</p>
</div>
<div class="paragraph">
<p>Notice too that <code>ConsulConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClientConfiguration">HttpClientConfiguration</a> allowing you to customize the settings for the Consul client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Consul Registration Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: hello-world
consul:
  client:
    registration:
      enabled: true
      # Alters the tags
      tags:
        - hello
        - world
      # Alters the metadata
      meta:
        some: value
        instance_type: t2.medium
      # Alters the retry count
      retry-count: 5
      # Alters fail fast behaviour
      fail-fast: false
    defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discovery_services_from_consul">Discovery Services from Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To discovery other services you could manually interact with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/discovery/DiscoveryClient">DiscoveryClient</a>, however typically instead you use the <a href="https://docs.micronaut.io/latest/guide/index.html#clientAnnotation">Client Annotation</a> to declare how an HTTP client maps to a service.</p>
</div>
<div class="paragraph">
<p>For example the configuration in the previous section declared a value for <code>micronaut.application.name</code> of <code>hello-world</code>. This is the value that will be used as the service ID when registering with Consul.</p>
</div>
<div class="paragraph">
<p>Other services can discovery instances of the <code>hello-world</code> service simply by declaring a client as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(id = "hello-world")
interface HelloClient{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also use <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/annotation/Client">@Client</a> as a qualifier to <code>@Inject</code> an instance of <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClient">HttpClient</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(id = "hello-world")
@Inject
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consul_health_checks">Consul Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when registering with Consul Micronaut will register a <a href="https://www.consul.io/docs/agent/checks.html">TTL check</a>. A TTL check basically means that if the application does not send a heartbeat back to Consul after a period of time the service is put in a failing state.</p>
</div>
<div class="paragraph">
<p>Micronaut applications feature a <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HeartbeatConfiguration">HeartbeatConfiguration</a> which starts a thread using <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HeartbeatTask">HeartbeatTask</a> that fires <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HeartbeatEvent">HeartbeatEvent</a> instances.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/registration/ConsulAutoRegistration.html">ConsulAutoRegistration</a> class listens for these events and sends a callback to the <a href="https://www.consul.io/api/agent/check.html">/agent/check/pass/:check_id</a> endpoint provided by Consul, effectively keeping the service alive.</p>
</div>
<div class="paragraph">
<p>With this arrangement the responsibility is on the Micronaut application to send TTL callbacks to Consul on a regular basis.</p>
</div>
<div class="paragraph">
<p>If you prefer you can push the responsibility for health checks to Consul itself by registering an HTTP check:</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
  client:
    registration:
       check:
         http: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration option in place Consul will assume responsibility of invoking the Micronaut applications <a href="https://docs.micronaut.io/latest/guide/index.html#healthEndpoint">Health Endpoint</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_controlling_ip_host_registration">Controlling IP/Host Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Occasionally, depending on the deployment environment you may wish to expose the IP address and not the host name, since by default Micronaut will register with Consul with either the value of the <code>HOST</code> environment variable or the value configured via <code>micronaut.server.host</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>consul.client.registration.prefer-ip-address</code> setting to indicate you would prefer to register with the IP address.</p>
</div>
<div class="paragraph">
<p>Micronaut will by default perform an IP lookup to try and figure out the IP address, however you can use the <code>consul.client.registration.ip-addr</code> setting to specify the IP address of the service directly.</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
  client:
    registration:
      ip-addr: &lt;your base container ip&gt;
      prefer-ip-address: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will tell Consul to register the IP that other instances can use to access your service and not the NAT IP it is running under (or 127.0.0.1).</p>
</div>
<div class="paragraph">
<p>If you use HTTP health checks (see the previous section) then Consul will use the configured IP address to check the Micronaut <code>/health</code> endpoint.</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
  client:
    registration:
      ip-addr: &lt;your base container ip&gt;
      prefer-ip-address: true
      check:
        http: true</code></pre>
</div>
</div>
</div>
</div>

<h1 id="serviceDiscoveryEureka"><a class="anchor" href="#serviceDiscoveryEureka"></a>4 Eureka Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-discovery-client/edit/master/src/main/docs/guide/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka">Netflix Eureka</a> is a popular discovery server deployed at scale at organizations like Netflix.</p>
</div>
<div class="paragraph">
<p>Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/eureka/client/v2/EurekaClient.html">EurekaClient</a> as part of the <code>discovery-client</code> module that does not require any additional third-party dependencies and is built using Micronaut&#8217;s support for <a href="https://docs.micronaut.io/latest/guide/index.html#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_eureka">Starting Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start a Eureka server is to use to use <a href="https://spring.io/guides/gs/service-registration-and-discovery/#initial">Spring Boot&#8217;s Eureka starters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of this writing the official Docker images for Eureka are significantly out-of-date so it is recommended to create a Eureka server following the steps above.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_eureka">Auto Registering with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process to register a Micronaut application with Eureka is very similar to with Consul, as seen in the previous section, simply add the necessary <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka (application.yml)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
eureka:
  client:
    registration:
      enabled: true
    defaultZone: "${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_eureka_service_registration">Customizing Eureka Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize various aspects of registration with Eureka using the <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. Notice that <code>EurekaConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClientConfiguration">HttpClientConfiguration</a> allowing you to customize the settings for the Eureka client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="listingblock">
<div class="title">Example Eureka Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">eureka:
  client:
    readTimeout: 5s
    registration:
      asgName: myAsg # the auto scaling group name
      countryId: 10 # the country id
      vipAddress: 'myapp' # The Eureka VIP address
      leaseInfo:
        durationInSecs: 60 # The lease information
      metadata: # arbitrary instance metadata
        foo: bar
      retry-count: 10 # How many times to retry
      retry-delay: 5s # How long to wait between retries
      appname: some-app-name     # optional, eureka instance application name, defaults to ${micronaut.application.name}
      hostname: foo.example.com  # optional, exposed eureka instance hostname, useful in docker bridged network environments
      ip-addr: 1.2.3.4           # optional, exposed eureka instance ip address, useful in docker bridged network environments
      port: 9090                 # optional, exposed eureka instance port, useful in docker bridged network environments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::/home/runner/work/micronaut-discovery-client/micronaut-discovery-client/build/generated/configurationProperties/io.micronaut.discovery.eureka.EurekaConfiguration$EurekaRegistrationConfiguration.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_basic_authentication">Eureka Basic Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the Eureka credentials in the URI you specify to in <code>defaultZone</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">eureka:
  client:
    defaultZone: "https://${EUREKA_USERNAME}:${EUREKA_PASSWORD}@localhost:8761"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example externalizes configuration of the username and password Eureka to environment variables called <code>EUREKA_USERNAME</code> and <code>EUREKA_PASSWORD</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_health_checks">Eureka Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like Consul, the <a href="../api/io/micronaut/discovery/eureka/registration/EurekaAutoRegistration.html">EurekaAutoRegistration</a> will send <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HeartbeatEvent">HeartbeatEvent</a> instances with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HealthStatus">HealthStatus</a> of the Micronaut application to Eureka.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/management/health/monitor/HealthMonitorTask">HealthMonitorTask</a> will by default continuously monitor the <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/HealthStatus">HealthStatus</a> of the application by running health checks and the <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/CurrentHealthStatus">CurrentHealthStatus</a> will be sent to Eureka.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secure_communication_with_eureka">Secure Communication with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to configure HTTPS and have clients discovery Eureka instances and communicate over HTTPS then you should set the <code>eureka.client.discovery.use-secure-port</code> option to <code>true</code> to ensure that service communication happens over HTTPS and also configure <a href="https://docs.micronaut.io/latest/guide/index.html#https">HTTPS</a> appropriately for each instance.</p>
</div>
</div>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>5 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-discovery-client/edit/master/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-discovery-client">https://github.com/micronaut-projects/micronaut-discovery-client</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>